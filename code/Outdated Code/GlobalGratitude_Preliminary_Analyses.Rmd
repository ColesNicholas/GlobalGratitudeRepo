---
title: "GlobalGratitude_Preliminary_Data"
output: html_notebook
---
```{r libraries}
library(dplyr)
library(effsize)
library(ggplot2)
library(qualtRics)
library(metafor)
library(scales)
library(ggtext)
```
```{r survey data}
# fetch survey
DF <- fetch_survey(surveyID = 'SV_1YQ3FmlbEHp1RIO',
                   force_request = T,
                   label = F,
                   convert = F)

# fix known issues
DF <- DF %>% 
  
  # 4/22/2024 TUR_01 used real link for testing purposes
  filter(ResponseId != "R_42KUGZSS76NgWH7",
         ResponseId != "R_4W4EXfgeyk1rCYF",
         ResponseId != "R_45Z862EIfzYcin4",
         ResponseId != "R_7BhJx9Ci7THupmF",
         ResponseId != "R_42Lv9fg5qi9V9xm",
         ResponseId != "R_2kFa26mh78uevnz",
         ResponseId != "R_4DRThnH8LgbEvM8",
         ResponseId != "R_4r1kAEqQCo1PNn6",
         ResponseId != "R_4GQErqyYDlRWVwZ",
         ResponseId != "R_4SGF0GCHSHIN0ls",
         ResponseId != "R_6Pndj5c7sr1pcU3",
         ResponseId != "R_8lQxsY2ITg7HKh1",
         #USA_01 duplicate data
         ResponseId != "R_6rDfD5u84z6WufT",
         #DZA_01 test data
         ResponseId != "R_4ioYJK1zR2FgR4R",
         ResponseId != "R_4OvlyOmeTsmLpFn",
         ResponseId != "R_4BA1gbglSYnVyDK",
         #TUR_01 duplicate data
         ResponseId != "R_8HXsI5PQftiJUYk",
         ResponseId != "R_8iVWI3CN49ACiUp",
         lab != "KEN_01",
         DistributionChannel != "preview",
         consent == 1,
         Progress > 95,
         condition_type != "NA",
         lab != "NA")

```
```{r set up}
data <- DF %>%
  select(StartDate:inequality_4, sex:totalOnTask)

data$gratitude_all <- rowMeans(data[, c("grateful", "thankful", "appreciative")], na.rm = TRUE)
data$happy_all <- rowMeans(data[, c("happy", "satisfied", "content", "joyful", "pleased")], na.rm = TRUE)
data$optimistic_all <- rowMeans(data[, c("optimistic", "hopeful")], na.rm = TRUE)
data$sad_all <- rowMeans(data[, c("sad", "depressed", "anxious", "nervous")], na.rm = TRUE)
data$indebted_all <- rowMeans(data[, c("indebted", "obligated")], na.rm = TRUE)
data$envy_all <- rowMeans(data[, c("envious", "bitter", "jealous")], na.rm = TRUE)
data$ls_all <- rowMeans(data[, c("ls_1", "ls_2", "ls_3", "ls_4", "ls_5")], na.rm = TRUE)
data$inequality <- rowMeans(data[, c("inequality_1", "inequality_2", "inequality_3", "inequality_4")], na.rm = TRUE)
data$condition_type <- factor(data$condition_type, levels = c("control", "intervention"))
data$condition_type <- relevel(data$condition_type, ref = "intervention")

```
```{r set up country names}

data <- data %>%
  mutate(country = case_when(
    lab == "POL_01" ~ "Poland",
    lab == "POL_02" ~ "Poland",
    lab == "DNK_01" ~ "Denmark",
    lab == "TUR_01" ~ "Turkey",
    lab == "MYS_01" ~ "Malaysia",
    lab == "USA_01" ~ "United States",
    lab == "USA_02" ~ "United States",
    lab == "NGA_01" ~ "Nigeria",
    lab == "NGA_02" ~ "Nigeria",
    lab == "CAN_01" ~ "Canada",
    lab == "FRA_01" ~ "France",
    lab == "AUS_01" ~ "Australia",
    lab == "CHL_01" ~ "Chile",
    lab == "DEU_01" ~ "Germany",
    lab == "GRC_01" ~ "Greece",
    lab == "HUN_01" ~ "Hungary",
    lab == "ISR_01" ~ "Israel",
    lab == "IRL_01" ~ "Ireland",
    lab == "MEX_01" ~ "Mexico",
    lab == "ITA_01" ~ "Italy",
    lab == "PRT_01" ~ "Portugal",
    lab == "BRA_01" ~ "Brazil",
    lab == "NLD_01" ~ "Netherlands",
    lab == "GBR_01" ~ "United Kingdom",
    lab == "ESP_01" ~ "Spain",
    lab == "ZAF_01" ~ "South Africa",
    lab == "KOR_01" ~ "South Korea",
    lab == "SWE_01" ~ "Sweden",
    lab == "IND_01" ~ "India",
    lab == "COL_01" ~ "Colombia",
    lab == "CHN_01" ~ "China",
    lab == "KAZ_01" ~ "Kazakhstan",
    lab == "NOR_01" ~ "Norway",
    lab == "JPN_01" ~ "Japan",
    lab == "GHA_01" ~ "Ghana",
    lab == "THA_01" ~ "Thailand",
    TRUE ~ NA_character_
  ))

control_data <- subset(data, condition_type == "control")
intervention_data <- subset(data, condition_type == "intervention")

unique_labs <- unique(data$country)
condition_names <- c("list", "letter", "text", "hk.list", "sub", "god.letter")

```


```{r gratitude control/interventions}

grat_results_df <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

gratitude_results_list <- sapply(unique_labs, function(lab_name){
  
  # Subset data for the current lab
  lab_data <- subset(data, country == lab_name)
  
  # Count observations for each condition type
  condition_counts <- table(lab_data$condition_type)

    # Check if both groups doesn't have at least 20 observations
  if (any(condition_counts < 20)) {
    return(NULL)  # Skip if the condition is not met
  }

  # Calculate t-test
  t_test_result <- t.test(gratitude_all ~ condition_type, data = lab_data)
  
  # Calculate Cohen's d effect size
  effect_size_result <- cohen.d(gratitude_all ~ condition_type, data = lab_data)
  
  # Calculate variances and counts for each group
  vars <- sapply(levels(lab_data$condition_type), function(cond) var(lab_data$gratitude_all[lab_data$condition_type == cond], na.rm = TRUE))
  ns <- sapply(levels(lab_data$condition_type), function(cond) sum(lab_data$condition_type == cond))
  
  # Calculate pooled standard error
  standard_error <- sqrt((vars["intervention"] / ns["intervention"]) + (vars["control"] / ns["control"]))
  
  # Store the results in the data frame
  result <- data.frame(
    lab = lab_name,
    test = "All Interventions",
    t_statistic = t_test_result$statistic,
    p_value = t_test_result$p.value,
    effect_size = effect_size_result$estimate,
    standard_error = standard_error,
    stringsAsFactors = FALSE
  )
  
  # Return the result for the current lab
  return(result)
}, simplify = FALSE)

grat_results_df <- do.call(rbind, gratitude_results_list)

# Calculate 95% confidence intervals
grat_results_df <- grat_results_df %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(grat_results_df)

#Control vs. Interventions (Gratitude) - Total
grat_results_df <- na.omit(grat_results_df)
grat_res <- rma(yi = effect_size, sei = standard_error, data = grat_results_df, method = "REML")

overall_effect_size <- grat_res$b
tau <- sqrt(grat_res$tau2)
pval <- grat_res$pval

grat_rma_df <- data.frame(
  test = "All Interventions",
  overall_eff_size = overall_effect_size,
  tau = tau,
  pval = pval,
  stringsAsFactors = FALSE
)

# View the resulting data frame
print(grat_rma_df)

```
```{r gratitude dataframes}

grat_control_df <- data.frame(
  lab = control_data$country,
  condition = control_data$condition_type,
  mean_gratitude = control_data$gratitude_all,
  stringsAsFactors = FALSE
)

grat_intervention_df <- data.frame(
  lab = intervention_data$country,
  condition = intervention_data$condition,
  mean_gratitude = intervention_data$gratitude_all,
  stringsAsFactors = FALSE
)

grat_combined_df <- rbind(grat_control_df, grat_intervention_df)

#Remove data without a mean_gratitude score
grat_combined_df <- grat_combined_df %>% 
    filter(mean_gratitude != "NaN")
```
```{r gratitude control/gratitude}
grat_results_df_2 <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

# Loop over each lab
for (lab_name in unique_labs) {
  
  # Subset data for the current lab
  lab_data <- subset(grat_combined_df, lab == lab_name)
  
  # Define control group
  control <- subset(lab_data, condition == "control")
  
  if (nrow(control) == 0) {
    next
  }
  
  # Create a list to store condition datasets
  grat_datasets <- lapply(condition_names, function(cond) {
    subset(lab_data, condition == cond)$mean_gratitude
  })
  
  # Assign names to the condition datasets
  names(grat_datasets) <- c(
    "List",
    "Letter",
    "Text",
    "Naikan List",
    "Mental Sub. Task",
    "Grat. to God Letter"
  )
  
  # Loop through each condition and perform the comparison
  for (i in seq_along(grat_datasets)) {
    
    # Extract the condition data
    condition_data <- grat_datasets[[i]]
    
    # Check observations
    if (length(control$mean_gratitude) < 10 || length(condition_data) < 10) {
      next
    }
    
    # Perform t-test
    t_test_result <- t.test(control$mean_gratitude, condition_data)
    
    # Calculate effect size
    effect_size <- effsize::cohen.d(control$mean_gratitude, condition_data, 
                                    hedges.correction = TRUE)
    
    # Calculate variances and sample sizes
    var_control <- var(control$mean_gratitude, na.rm = TRUE)
    var_condition <- var(condition_data, na.rm = TRUE)
    n_control <- length(control$mean_gratitude)
    n_condition <- length(condition_data)
    
    # Calculate standard error of the difference
    standard_error <- sqrt((var_control / n_control) + (var_condition / n_condition))
    
    # Add results to dataframe
    grat_results_df_2 <- rbind(grat_results_df_2, data.frame(
      lab = lab_name,
      test = names(grat_datasets)[i],
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    ))
  }
}

# Adjust effect size
grat_results_df_2$effect_size <- grat_results_df_2$effect_size * -1

# Calculate 95% confidence intervals
grat_results_df_2 <- grat_results_df_2 %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(grat_results_df_2)

grat_res_2 <- lapply(unique(grat_results_df_2$test), function(test_value){
  
  # Subset the data for the current test
  subset_data <- grat_results_df_2 %>% filter(test == test_value)
  
  model_result <- rma(yi = effect_size, sei = standard_error, data = subset_data, method = "REML")
  
  overall_effect_size <- model_result$b
  tau <- sqrt(model_result$tau2)
  pval <- model_result$pval

  # Return these values as a list
  return(list(test = test_value, overall_eff_size = overall_effect_size, tau = tau, pval = pval))
})

# Now, combine the results back into the original dataframe
# Create a data frame from the list of results
grat_rma_df_2 <- do.call(rbind, lapply(grat_res_2, function(x) {
  data.frame(test = x$test, overall_eff_size = x$overall_eff_size, tau = x$tau, pval = x$pval)
}))

# Merge the results with the original dataframe by 'test' column
combined_gratitude_rma_df <- rbind(grat_rma_df, grat_rma_df_2)

# View the updated data frame
print(combined_gratitude_rma_df)

# Combine Dataframes
combined_gratitude_df <- rbind(grat_results_df, grat_results_df_2)
combined_gratitude_df$test <- factor(combined_gratitude_df$test, levels = c(
  "List", "Letter", "Text", "Naikan List", "Mental Sub. Task", "Grat. to God Letter", "All Interventions"
))


```
```{r gratitude forest plot}

# Create the custom labels
combined_gratitude_rma_df <- combined_gratitude_rma_df %>%
  mutate(
    custom_label = paste0("<b>", test, "</b>\n",  # Bold the test name
                         "\nd = ", round(overall_eff_size, 3), 
                         ifelse(pval < 0.05, " *", ""), 
                         " | τ = ", round(tau, 3))
  )

# Create the forest plot with custom facet labels (bold test part)
forest_plot <- ggplot(combined_gratitude_df, aes(x = effect_size, y = reorder(lab, effect_size),
                                                     xmin = lower_ci, xmax = upper_ci, color = test)) +
  facet_grid(~test, labeller = labeller(test = setNames(combined_gratitude_rma_df$custom_label, combined_gratitude_rma_df$test))) +
  geom_point(size = 2.5) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Gratitude Effect Sizes by Condition",
    color = "Condition"
  ) +
  scale_color_manual(values = c(
    "List" = "deepskyblue2",
    "Letter" = "orchid",
    "Text" = "tan",
    "Naikan List" = "lightblue",
    "Mental Sub. Task" = "lightpink",
    "Grat. to God Letter" = "aquamarine",
    "All Interventions" = "darkgray"
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text.x = element_markdown(size = 5.7),  # This is using ggtext for markdown
    plot.title = element_text(hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 4.7),
    axis.text.y = element_text(size = 8)
  ) +
  scale_x_continuous(labels = scales::number_format(accuracy = 0.1)) +  
  geom_vline(xintercept = 0, linetype = "dashed", color = "red")

# Print the plot
print(forest_plot)

```

```{r pa control/interventions}

pa_results_df <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

pa_results_list <- sapply(unique_labs, function(lab_name){
  
  # Subset data for the current lab
  lab_data <- subset(data, country == lab_name)
  
  # Count observations for each condition type
  condition_counts <- table(lab_data$condition_type)
  
  # Check if both groups doesn't have at least 20 observations
  if (any(condition_counts < 20)) {
    return(NULL)  # Skip if the condition is not met
  }
  
  else {
    # Calculate t-test
    t_test_result <- t.test(happy_all ~ condition_type, data = lab_data)
    
    # Calculate Cohen's d effect size
    effect_size_result <- cohen.d(happy_all ~ condition_type, data = lab_data)
    
    # Calculate variances and counts for each group
    vars <- sapply(levels(lab_data$condition_type), function(cond) var(lab_data$happy_all[lab_data$condition_type == cond], na.rm = TRUE))
    ns <- sapply(levels(lab_data$condition_type), function(cond) sum(lab_data$condition_type == cond))
    
    # Calculate pooled standard error
    standard_error <- sqrt((vars["intervention"] / ns["intervention"]) + (vars["control"] / ns["control"]))
    
    # Store the results in the data frame
    result <- data.frame(
      lab = lab_name,
      test = "All Interventions",
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size_result$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    )
  }
  
  return(result)
}, simplify = FALSE)

pa_results_df <- do.call(rbind, pa_results_list)

# Calculate 95% confidence intervals
pa_results_df <- pa_results_df %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(pa_results_df)

#Control vs. Interventions (Positive Affect) - Total
pa_results_df <- na.omit(pa_results_df)
pa_res <- rma(yi = effect_size, sei = standard_error, data = pa_results_df, method = "REML")
# Extract the overall effect size and tau2 from the rma object
overall_effect_size <- pa_res$b
tau <- sqrt(pa_res$tau2)
pval <- pa_res$pval

pa_rma_df <- data.frame(
  test = "All Interventions",
  overall_eff_size = overall_effect_size,
  tau = tau,
  pval = pval,
  stringsAsFactors = FALSE
)

# View the resulting data frame
print(pa_rma_df)

```
```{r pa dataframes}

pa_control_df <- data.frame(
  lab = control_data$country,
  condition = control_data$condition_type,
  mean_pa = control_data$happy_all,
  stringsAsFactors = FALSE
)

pa_intervention_df <- data.frame(
  lab = intervention_data$country,
  condition = intervention_data$condition,
  mean_pa = intervention_data$happy_all,
  stringsAsFactors = FALSE
)

pa_combined_df <- rbind(pa_control_df, pa_intervention_df)

#Remove data without a mean_pa score
pa_combined_df <- pa_combined_df %>% 
  filter(mean_pa != "NaN")
```
```{r pa control/gratitude}

pa_results_df_2 <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

unique_labs <- unique(pa_combined_df$lab)
condition_names <- c("list", "letter", "text", "hk.list", "sub", "god.letter")

# Loop over each lab
for (lab_name in unique_labs) {
  
  # Subset data for the current lab
  lab_data <- subset(pa_combined_df, lab == lab_name)
  
  # Define control group
  control <- subset(lab_data, condition == "control")
  
  if (nrow(control) == 0) {
    next
  }
  
  # Create a list to store condition datasets
  pa_datasets <- lapply(condition_names, function(cond) {
    subset(lab_data, condition == cond)$mean_pa
  })
  
  # Assign names to the condition datasets
  names(pa_datasets) <- c(
    "List",
    "Letter",
    "Text",
    "Naikan List",
    "Mental Sub. Task",
    "Grat. to God Letter"
  )
  
  # Loop through each condition and perform the comparison
  for (i in seq_along(pa_datasets)) {
    
    # Extract the condition data
    condition_data <- pa_datasets[[i]]
    
    # Check observations
    if (length(control$mean_pa) < 10 || length(condition_data) < 10) {
      next
    }
    
    # Perform t-test
    t_test_result <- t.test(control$mean_pa, condition_data)
    
    # Calculate effect size
    effect_size <- effsize::cohen.d(control$mean_pa, condition_data, 
                                    hedges.correction = TRUE)
    
    # Calculate variances and sample sizes
    var_control <- var(control$mean_pa, na.rm = TRUE)
    var_condition <- var(condition_data, na.rm = TRUE)
    n_control <- length(control$mean_pa)
    n_condition <- length(condition_data)
    
    # Calculate standard error of the difference
    standard_error <- sqrt((var_control / n_control) + (var_condition / n_condition))
    
    # Add results to dataframe
    pa_results_df_2 <- rbind(pa_results_df_2, data.frame(
      lab = lab_name,
      test = names(pa_datasets)[i],
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    ))
  }
}

# Adjust effect size
pa_results_df_2$effect_size <- pa_results_df_2$effect_size * -1

# Calculate 95% confidence intervals
pa_results_df_2 <- pa_results_df_2 %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(pa_results_df_2)

pa_res_2 <- lapply(unique(pa_results_df_2$test), function(test_value){
  
  # Subset the data for the current test
  subset_data <- pa_results_df_2 %>% filter(test == test_value)
  
  # Run the random-effects model using rma
  model_result <- rma(yi = effect_size, sei = standard_error, data = subset_data, method = "REML")
  
  # Extract the overall effect size (b) and tau2 (heterogeneity variance)
  overall_effect_size <- model_result$b
  tau <- sqrt(model_result$tau2)
  pval <- model_result$pval

  # Return these values as a list
  return(list(test = test_value, overall_eff_size = overall_effect_size, tau = tau, pval = pval))
})

# Now, combine the results back into the original dataframe
# Create a data frame from the list of results
pa_rma_df_2 <- do.call(rbind, lapply(pa_res_2, function(x) {
  data.frame(test = x$test, overall_eff_size = x$overall_eff_size, tau = x$tau, pval= x$pval)
}))

# Merge the results with the original dataframe by 'test' column
combined_pa_rma_df <- rbind(pa_rma_df, pa_rma_df_2)

# View the updated data frame
print(combined_pa_rma_df)

# Combine Dataframes
combined_pa_df <- rbind(pa_results_df, pa_results_df_2)
combined_pa_df$test <- factor(combined_pa_df$test, levels = c(
  "List", "Letter", "Text", "Naikan List", "Mental Sub. Task", "Grat. to God Letter", "All Interventions"
))


```
```{r pa forest plot}

# Create the custom labels
combined_pa_rma_df <- combined_pa_rma_df %>%
 mutate(
    custom_label = paste0("<b>", test, "</b>\n",
                         "\nd = ", round(overall_eff_size, 3), 
                         ifelse(pval < 0.05, " *", ""),
                         " | τ = ", round(tau, 3))
  )

# Create the forest plot with custom facet labels (bold test part)
forest_plot <- ggplot(combined_pa_df, aes(x = effect_size, y = reorder(lab, effect_size), xmin = lower_ci, xmax = upper_ci, color = test)) +
  facet_grid(~test, labeller = labeller(test = setNames(combined_pa_rma_df$custom_label, combined_pa_rma_df$test))) +
  geom_point(size = 2.5) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Positive Affect Effect Sizes by Condition",
    color = "Condition"
  ) +
  scale_color_manual(values = c(
    "List" = "deepskyblue2",
    "Letter" = "orchid",
    "Text" = "tan",
    "Naikan List" = "lightblue",
    "Mental Sub. Task" = "lightpink",
    "Grat. to God Letter" = "aquamarine",
    "All Interventions" = "darkgray"
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text.x = element_markdown(size = 5.7),
    plot.title = element_text(hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 4.7),
    axis.text.y = element_text(size = 8)
  ) +
  scale_x_continuous(labels = number_format(accuracy = 0.1)) +  
  geom_vline(xintercept = 0, linetype = "dashed", color = "red")

# Print the plot
print(forest_plot)

```

```{r na control/interventions}

na_results_df <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

na_results_list <- sapply(unique_labs, function(lab_name){
  
  # Subset data for the current lab
  lab_data <- subset(data, country == lab_name)
  
  # Count observations for each condition type
  condition_counts <- table(lab_data$condition_type)
  
  # Check if both groups doesn't have at least 20 observations
  if (any(condition_counts < 20)) {
    return(NULL)  # Skip if the condition is not met
  }
  
  # Calculate t-test
  t_test_result <- t.test(sad_all ~ condition_type, data = lab_data)
  
  # Calculate Cohen's d effect size
  effect_size_result <- cohen.d(sad_all ~ condition_type, data = lab_data)
  
  # Calculate variances and counts for each group
  vars <- sapply(levels(lab_data$condition_type), function(cond) var(lab_data$sad_all[lab_data$condition_type == cond], na.rm = TRUE))
  ns <- sapply(levels(lab_data$condition_type), function(cond) sum(lab_data$condition_type == cond))
  
  # Calculate pooled standard error
  standard_error <- sqrt((vars["intervention"] / ns["intervention"]) + (vars["control"] / ns["control"]))
  
  # Store the results in the data frame
  result <- data.frame(
    lab = lab_name,
    test = "All Interventions",
    t_statistic = t_test_result$statistic,
    p_value = t_test_result$p.value,
    effect_size = effect_size_result$estimate,
    standard_error = standard_error,
    stringsAsFactors = FALSE
  )
  
  # Return the result for the current lab
  return(result)
}, simplify = FALSE)

na_results_df <- do.call(rbind, na_results_list)

# Calculate 95% confidence intervals
na_results_df <- na_results_df %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(na_results_df)

#Control vs. Interventions (Negative Affect) - Total
na_results_df <- na.omit(na_results_df)
na_res <- rma(yi = effect_size, sei = standard_error, data = na_results_df, method = "REML")
# Extract the overall effect size and tau2 from the rma object
overall_effect_size <- na_res$b
tau <- sqrt(na_res$tau2)
pval <- na_res$pval

na_rma_df <- data.frame(
  test = "All Interventions",
  overall_eff_size = overall_effect_size,
  tau = tau,
  pval = pval,
  stringsAsFactors = FALSE
)

# View the resulting data frame
print(na_rma_df)


```
```{r na dataframes}

na_control_df <- data.frame(
  lab = control_data$country,
  condition = control_data$condition_type,
  mean_na = control_data$sad_all,
  stringsAsFactors = FALSE
)

na_intervention_df <- data.frame(
  lab = intervention_data$country,
  condition = intervention_data$condition,
  mean_na = intervention_data$sad_all,
  stringsAsFactors = FALSE
)

na_combined_df <- rbind(na_control_df, na_intervention_df)

#Remove data without a mean_na score
na_combined_df <- na_combined_df %>% 
  filter(mean_na != "NaN")
```
```{r na control/gratitude}
na_results_df_2 <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

# Loop over each lab
for (lab_name in unique_labs) {
  
  # Subset data for the current lab
  lab_data <- subset(na_combined_df, lab == lab_name)
  
  # Define control group
  control <- subset(lab_data, condition == "control")
  
  if (nrow(control) == 0) {
    next
  }
  
  # Create a list to store condition datasets
  na_datasets <- lapply(condition_names, function(cond) {
    subset(lab_data, condition == cond)$mean_na
  })
  
  # Assign names to the condition datasets
  names(na_datasets) <- c(
    "List",
    "Letter",
    "Text",
    "Naikan List",
    "Mental Sub. Task",
    "Grat. to God Letter"
  )
  
  # Loop through each condition and perform the comparison
  for (i in seq_along(na_datasets)) {
    
    # Extract the condition data
    condition_data <- na_datasets[[i]]
    
    # Check observations
    if (length(control$mean_na) < 10 || length(condition_data) < 10) {
      next
    }
    
    # Perform t-test
    t_test_result <- t.test(control$mean_na, condition_data)
    
    # Calculate effect size
    effect_size <- effsize::cohen.d(control$mean_na, condition_data, 
                                    hedges.correction = TRUE)
    
    # Calculate variances and sample sizes
    var_control <- var(control$mean_na, na.rm = TRUE)
    var_condition <- var(condition_data, na.rm = TRUE)
    n_control <- length(control$mean_na)
    n_condition <- length(condition_data)
    
    # Calculate standard error of the difference
    standard_error <- sqrt((var_control / n_control) + (var_condition / n_condition))
    
    # Add results to dataframe
    na_results_df_2 <- rbind(na_results_df_2, data.frame(
      lab = lab_name,
      test = names(na_datasets)[i],
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    ))
  }
}

# Adjust effect size
na_results_df_2$effect_size <- na_results_df_2$effect_size * -1

# Calculate 95% confidence intervals
na_results_df_2 <- na_results_df_2 %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(na_results_df_2)

na_res_2 <- lapply(unique(na_results_df_2$test), function(test_value){
  
  # Subset the data for the current test
  subset_data <- na_results_df_2 %>% filter(test == test_value)
  
  # Run the random-effects model using rma
  model_result <- rma(yi = effect_size, sei = standard_error, data = subset_data, method = "REML")
  
  # Extract the overall effect size (b) and tau2 (heterogeneity variance)
  overall_effect_size <- model_result$b
  tau <- sqrt(model_result$tau2)
  pval <- model_result$pval
  
  # Return these values as a list
  return(list(test = test_value, overall_eff_size = overall_effect_size, tau = tau, pval = pval))
})

# Now, combine the results back into the original dataframe
# Create a data frame from the list of results
na_rma_df_2 <- do.call(rbind, lapply(na_res_2, function(x) {
  data.frame(test = x$test, overall_eff_size = x$overall_eff_size, tau = x$tau, pval = x$pval)
}))

# Merge the results with the original dataframe by 'test' column
combined_na_rma_df <- rbind(na_rma_df, na_rma_df_2)

# View the updated data frame
print(combined_na_rma_df)

# Combine Dataframes
combined_na_df <- rbind(na_results_df, na_results_df_2)
combined_na_df$test <- factor(combined_na_df$test, levels = c(
  "List", "Letter", "Text", "Naikan List", "Mental Sub. Task", "Grat. to God Letter", "All Interventions"
))


```
```{r na forest plot}

# Create the custom labels
combined_na_rma_df <- combined_na_rma_df %>%
  mutate(
    custom_label = paste0("<b>", test, "</b>\n",
                         "\nd = ", round(overall_eff_size, 3), 
                         ifelse(pval < 0.05, " *", ""),
                         " | τ = ", round(tau, 3))
  )

# Create the forest plot with custom facet labels (bold test part)
forest_plot <- ggplot(combined_na_df, aes(x = effect_size, y = reorder(lab, effect_size),
                                                 xmin = lower_ci, xmax = upper_ci, color = test)) +
  facet_grid(~test, labeller = labeller(test = setNames(combined_na_rma_df$custom_label, combined_na_rma_df$test))) +
  geom_point(size = 2.5) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Negative Affect Effect Sizes by Condition",
    color = "Condition"
  ) +
  scale_color_manual(values = c(
    "List" = "deepskyblue2",
    "Letter" = "orchid",
    "Text" = "tan",
    "Naikan List" = "lightblue",
    "Mental Sub. Task" = "lightpink",
    "Grat. to God Letter" = "aquamarine",
    "All Interventions" = "darkgray"
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text.x = element_markdown(size = 5.7),
    plot.title = element_text(hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 4.7),
    axis.text.y = element_text(size = 8)
  ) +
  scale_x_continuous(labels = number_format(accuracy = 0.1)) +  
  geom_vline(xintercept = 0, linetype = "dashed", color = "red")

# Print the plot
print(forest_plot)

```

```{r life satisfaction control/interventions}

ls_results_df <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

ls_results_list <- sapply(unique_labs, function(lab_name){
  
  # Subset data for the current lab
  lab_data <- subset(data, country == lab_name)
  
  # Count observations for each condition type
  condition_counts <- table(lab_data$condition_type)
  
    # Check if both groups doesn't have at least 20 observations
  if (any(condition_counts < 20)) {
    return(NULL)  # Skip if the condition is not met
  }

  else {
    # Calculate t-test
    t_test_result <- t.test(ls_all ~ condition_type, data = lab_data)
    
    # Calculate Cohen's d effect size
    effect_size_result <- cohen.d(ls_all ~ condition_type, data = lab_data)
    
    # Calculate variances and counts for each group
    vars <- sapply(levels(lab_data$condition_type), function(cond) var(lab_data$ls_all[lab_data$condition_type == cond], na.rm = TRUE))
    ns <- sapply(levels(lab_data$condition_type), function(cond) sum(lab_data$condition_type == cond))
    
    # Calculate pooled standard error
    standard_error <- sqrt((vars["intervention"] / ns["intervention"]) + (vars["control"] / ns["control"]))
    
    # Store the results in the data frame
    result <- data.frame(
      lab = lab_name,
      test = "All Interventions",
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size_result$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    )
  }
  
  return(result)
}, simplify = FALSE)

ls_results_df <- do.call(rbind, ls_results_list)

# Calculate 95% confidence intervals
ls_results_df <- ls_results_df %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(ls_results_df)

#Control vs. Interventions (Life Satisfaction) - Total
ls_results_df <- na.omit(ls_results_df)
ls_res <- rma(yi = effect_size, sei = standard_error, data = ls_results_df, method = "REML")
# Extract the overall effect size and tau2 from the rma object
overall_effect_size <- ls_res$b
tau <- sqrt(ls_res$tau2)
pval <- ls_res$pval

ls_rma_df <- data.frame(
  test = "All Interventions",
  overall_eff_size = overall_effect_size,
  tau = tau,
  pval = pval,
  stringsAsFactors = FALSE
)

# View the resulting data frame
print(ls_rma_df)

```
```{r life satisfaction dataframes}

ls_control_df <- data.frame(
  lab = control_data$country,
  condition = control_data$condition_type,
  mean_ls = control_data$ls_all,
  stringsAsFactors = FALSE
)

ls_intervention_df <- data.frame(
  lab = intervention_data$country,
  condition = intervention_data$condition,
  mean_ls = intervention_data$ls_all,
  stringsAsFactors = FALSE
)

ls_combined_df <- rbind(ls_control_df, ls_intervention_df)

#Remove data without a mean_ls score
ls_combined_df <- ls_combined_df %>% 
  filter(mean_ls != "NaN")
```
```{r life satisfaction control/gratitude}

ls_results_df_2 <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

unique_labs <- unique(ls_combined_df$lab)
condition_names <- c("list", "letter", "text", "hk.list", "sub", "god.letter")

# Loop over each lab
for (lab_name in unique_labs) {
  
  # Subset data for the current lab
  lab_data <- subset(ls_combined_df, lab == lab_name)
  
  # Define control group
  control <- subset(lab_data, condition == "control")
  
  if (nrow(control) == 0) {
    next
  }
  
  # Create a list to store condition datasets
  ls_datasets <- lapply(condition_names, function(cond) {
    subset(lab_data, condition == cond)$mean_ls
  })
  
  # Assign names to the condition datasets
  names(ls_datasets) <- c(
    "List",
    "Letter",
    "Text",
    "Naikan List",
    "Mental Sub. Task",
    "Grat. to God Letter"
  )
  
  # Loop through each condition and perform the comparison
  for (i in seq_along(ls_datasets)) {
    
    # Extract the condition data
    condition_data <- ls_datasets[[i]]
    
    # Check observations
    if (length(control$mean_ls) < 10 || length(condition_data) < 10) {
      next
    }
    
    # Perform t-test
    t_test_result <- t.test(control$mean_ls, condition_data)
    
    # Calculate effect size
    effect_size <- effsize::cohen.d(control$mean_ls, condition_data, 
                                    hedges.correction = TRUE)
    
    # Calculate variances and sample sizes
    var_control <- var(control$mean_ls, na.rm = TRUE)
    var_condition <- var(condition_data, na.rm = TRUE)
    n_control <- length(control$mean_ls)
    n_condition <- length(condition_data)
    
    # Calculate standard error of the difference
    standard_error <- sqrt((var_control / n_control) + (var_condition / n_condition))
    
    # Add results to dataframe
    ls_results_df_2 <- rbind(ls_results_df_2, data.frame(
      lab = lab_name,
      test = names(ls_datasets)[i],
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    ))
  }
}

# Adjust effect size
ls_results_df_2$effect_size <- ls_results_df_2$effect_size * -1

# Calculate 95% confidence intervals
ls_results_df_2 <- ls_results_df_2 %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(ls_results_df_2)

ls_res_2 <- lapply(unique(ls_results_df_2$test), function(test_value){
  
  subset_data <- ls_results_df_2 %>% filter(test == test_value)
  
  model_result <- rma(yi = effect_size, sei = standard_error, data = subset_data, method = "REML")
  
  overall_effect_size <- model_result$b
  tau <- sqrt(model_result$tau2)
  pval <- model_result$pval
  
  # Return these values as a list
  return(list(test = test_value, overall_eff_size = overall_effect_size, tau = tau, pval = pval))
})

# Now, combine the results back into the original dataframe
# Create a data frame from the list of results
ls_rma_df_2 <- do.call(rbind, lapply(ls_res_2, function(x) {
  data.frame(test = x$test, overall_eff_size = x$overall_eff_size, tau = x$tau, pval = x$pval)
}))

# Merge the results with the original dataframe by 'test' column
combined_ls_rma_df <- rbind(ls_rma_df, ls_rma_df_2)

# View the updated data frame
print(combined_ls_rma_df)

# Combine Dataframes
combined_ls_df <- rbind(ls_results_df, ls_results_df_2)
combined_ls_df$test <- factor(combined_ls_df$test, levels = c(
  "List", "Letter", "Text", "Naikan List", "Mental Sub. Task", "Grat. to God Letter", "All Interventions"
))


```
```{r ls forest plot}
# Create the custom labels
combined_ls_rma_df <- combined_ls_rma_df %>%
  mutate(
    custom_label = paste0("<b>", test, "</b>\n",
                         "\nd = ", round(overall_eff_size, 3), 
                         ifelse(pval < 0.05, " *", ""),
                         " | τ = ", round(tau, 3))
  )

# Create the forest plot with custom facet labels (bold test part)
forest_plot <- ggplot(combined_ls_df, aes(x = effect_size, y = reorder(lab, effect_size),
                                                 xmin = lower_ci, xmax = upper_ci, color = test)) +
  facet_grid(~test, labeller = labeller(test = setNames(combined_ls_rma_df$custom_label, combined_ls_rma_df$test))) +
  geom_point(size = 2.5) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Life Satisfaction Effect Sizes by Condition",
    color = "Condition"
  ) +
  scale_color_manual(values = c(
    "List" = "deepskyblue2",
    "Letter" = "orchid",
    "Text" = "tan",
    "Naikan List" = "lightblue",
    "Mental Sub. Task" = "lightpink",
    "Grat. to God Letter" = "aquamarine",
    "All Interventions" = "darkgray"
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text.x = element_markdown(size = 5.7),
    plot.title = element_text(hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 4.7),
    axis.text.y = element_text(size = 8)
  ) +
  scale_x_continuous(labels = number_format(accuracy = 0.1)) +  
  geom_vline(xintercept = 0, linetype = "dashed", color = "red")

# Print the plot
print(forest_plot)

```
###
```{r inequality control/interventions}

inequality_results_df <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

inequality_results_list <- sapply(unique_labs, function(lab_name){
  
  # Subset data for the current lab
  lab_data <- subset(data, country == lab_name)
  
  # Count observations for each condition type
  condition_counts <- table(lab_data$condition_type)
  
  # Check if both groups doesn't have at least 20 observations
  if (any(condition_counts < 20)) {
    return(NULL)  # Skip if the condition is not met
  }
  
  # Calculate t-test
  t_test_result <- t.test(inequality ~ condition_type, data = lab_data)
  
  # Calculate Cohen's d effect size
  effect_size_result <- cohen.d(inequality ~ condition_type, data = lab_data)
  
  # Calculate variances and counts for each group
  vars <- sapply(levels(lab_data$condition_type), function(cond) var(lab_data$inequality[lab_data$condition_type == cond], na.rm = TRUE))
  ns <- sapply(levels(lab_data$condition_type), function(cond) sum(lab_data$condition_type == cond))
  
  # Calculate pooled standard error
  standard_error <- sqrt((vars["intervention"] / ns["intervention"]) + (vars["control"] / ns["control"]))
  
  # Store the results in the data frame
  result <- data.frame(
    lab = lab_name,
    test = "All Interventions",
    t_statistic = t_test_result$statistic,
    p_value = t_test_result$p.value,
    effect_size = effect_size_result$estimate,
    standard_error = standard_error,
    stringsAsFactors = FALSE
  )
  
  # Return the result for the current lab
  return(result)
}, simplify = FALSE)

inequality_results_df <- do.call(rbind, inequality_results_list)

# Calculate 95% confidence intervals
inequality_results_df <- inequality_results_df %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(inequality_results_df)

#Control vs. Interventions (Gratitude) - Total
inequality_results_df <- na.omit(inequality_results_df)
inequality_res <- rma(yi = effect_size, sei = standard_error, data = inequality_results_df, method = "REML")
# Extract the overall effect size and tau2 from the rma object
overall_effect_size <- inequality_res$b
tau2 <- inequality_res$tau2

inequality_rma_df <- data.frame(
  test = "All Interventions",
  overall_eff_size = overall_effect_size,
  tau2 = tau2,
  stringsAsFactors = FALSE
)

# View the resulting data frame
print(inequality_rma_df)


```
```{r inequality dataframes}

inequality_control_df <- data.frame(
  lab = control_data$country,
  condition = control_data$condition_type,
  mean_inequality = control_data$inequality,
  stringsAsFactors = FALSE
)

inequality_intervention_df <- data.frame(
  lab = intervention_data$country,
  condition = intervention_data$condition,
  mean_inequality = intervention_data$inequality,
  stringsAsFactors = FALSE
)

inequality_combined_df <- rbind(inequality_control_df, inequality_intervention_df)

#Remove data without a mean_gratitude score
inequality_combined_df <- inequality_combined_df %>% 
  filter(mean_inequality != "NaN")
```
```{r inequality control/gratitude}

inequality_results_df_2 <- data.frame(
  lab = character(),
  test = character(),
  t_statistic = numeric(),
  p_value = numeric(),
  effect_size = numeric(),
  standard_error = numeric(),
  stringsAsFactors = FALSE
)

unique_labs <- unique(inequality_combined_df$lab)
condition_names <- c("list", "letter", "text", "hk.list", "sub", "god.letter")

# Loop over each lab
for (lab_name in unique_labs) {
  
  # Subset data for the current lab
  lab_data <- subset(inequality_combined_df, lab == lab_name)
  
  # Define control group
  control <- subset(lab_data, condition == "control")
  
  if (nrow(control) == 0) {
    next
  }
  
  # Create a list to store condition datasets
  inequality_datasets <- lapply(condition_names, function(cond) {
    subset(lab_data, condition == cond)$mean_inequality
  })
  
  # Assign names to the condition datasets
  names(inequality_datasets) <- c(
    "List",
    "Letter",
    "Text",
    "Naikan List",
    "Mental Sub. Task",
    "Grat. to God Letter"
  )
  
  # Loop through each condition and perform the comparison
  for (i in seq_along(inequality_datasets)) {
    
    # Extract the condition data
    condition_data <- inequality_datasets[[i]]
    
    # Check observations
    if (length(control$mean_inequality) < 10 || length(condition_data) < 10) {
      next
    }
    
    # Perform t-test
    t_test_result <- t.test(control$mean_inequality, condition_data)
    
    # Calculate effect size
    effect_size <- effsize::cohen.d(control$mean_inequality, condition_data, 
                                    hedges.correction = TRUE)
    
    # Calculate variances and sample sizes
    var_control <- var(control$mean_inequality, na.rm = TRUE)
    var_condition <- var(condition_data, na.rm = TRUE)
    n_control <- length(control$mean_inequality)
    n_condition <- length(condition_data)
    
    # Calculate standard error of the difference
    standard_error <- sqrt((var_control / n_control) + (var_condition / n_condition))
    
    # Add results to dataframe
    inequality_results_df_2 <- rbind(inequality_results_df_2, data.frame(
      lab = lab_name,
      test = names(inequality_datasets)[i],
      t_statistic = t_test_result$statistic,
      p_value = t_test_result$p.value,
      effect_size = effect_size$estimate,
      standard_error = standard_error,
      stringsAsFactors = FALSE
    ))
  }
}

# Adjust effect size
inequality_results_df_2$effect_size <- inequality_results_df_2$effect_size * -1

# Calculate 95% confidence intervals
inequality_results_df_2 <- inequality_results_df_2 %>%
  mutate(
    lower_ci = effect_size - 1.96 * standard_error,
    upper_ci = effect_size + 1.96 * standard_error
  )

print(inequality_results_df_2)

inequality_res_2 <- lapply(unique(inequality_results_df_2$test), function(test_value){
  
  # Subset the data for the current test
  subset_data <- inequality_results_df_2 %>% filter(test == test_value)
  
  # Run the random-effects model using rma
  model_result <- rma(yi = effect_size, sei = standard_error, data = subset_data, method = "REML")
  
  # Extract the overall effect size (b) and tau2 (heterogeneity variance)
  overall_effect_size <- model_result$b
  tau2 <- model_result$tau2
  
  # Return these values as a list
  return(list(test = test_value, overall_eff_size = overall_effect_size, tau2 = tau2))
})

# Now, combine the results back into the original dataframe
# Create a data frame from the list of results
inequality_rma_df_2 <- do.call(rbind, lapply(inequality_res_2, function(x) {
  data.frame(test = x$test, overall_eff_size = x$overall_eff_size, tau2 = x$tau2)
}))

# Merge the results with the original dataframe by 'test' column
combined_inequality_rma_df <- rbind(inequality_rma_df, inequality_rma_df_2)

# View the updated data frame
print(combined_inequality_rma_df)

# Combine Dataframes
combined_inequality_df <- rbind(inequality_results_df, inequality_results_df_2)
combined_inequality_df$test <- factor(combined_inequality_df$test, levels = c(
  "List", "Letter", "Text", "Naikan List", "Mental Sub. Task", "Grat. to God Letter", "All Interventions"
))


```
```{r inequality forest plot}
# Create the custom labels
combined_inequality_rma_df <- combined_inequality_rma_df %>%
  mutate(
    custom_label = paste0("<b>", test, "</b>\n",  # Bold the test name
                          "\nτ² = ", round(tau2, 3), 
                          " | d = ", round(overall_eff_size, 3))
  )

# Create the forest plot with custom facet labels (bold test part)
forest_plot <- ggplot(combined_inequality_df, aes(x = effect_size, y = reorder(lab, effect_size),
                                          xmin = lower_ci, xmax = upper_ci, color = test)) +
  facet_grid(~test, labeller = labeller(test = setNames(combined_inequality_rma_df$custom_label, combined_inequality_rma_df$test))) +
  geom_point(size = 2.5) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Inequality Effect Sizes by Condition",
    color = "Condition"
  ) +
  scale_color_manual(values = c(
    "List" = "deepskyblue2",
    "Letter" = "orchid",
    "Text" = "tan",
    "Naikan List" = "lightblue",
    "Mental Sub. Task" = "lightpink",
    "Grat. to God Letter" = "aquamarine",
    "All Interventions" = "darkgray"
  )) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text.x = element_markdown(size = 5.7),
    plot.title = element_text(hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    axis.title.x = element_text(size = 8),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 4.7),
    axis.text.y = element_text(size = 8)
  ) +
  scale_x_continuous(labels = number_format(accuracy = 0.1)) +  
  geom_vline(xintercept = 0, linetype = "dashed", color = "red")

# Print the plot
print(forest_plot)

```
```{r gratitude forest}

# Create the forest plot
forest_plot <- ggplot(grat_results_df, aes(x = effect_size, y = reorder(lab, effect_size), 
                                        xmin = lower_ci, xmax = upper_ci))+
  geom_point(size = 3, aes(color = effect_size)) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Country",
    title = "Forest Plot of Effect Sizes of Gratitude by Lab"
  ) +
  theme_minimal() +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
  scale_color_gradient2(low = "yellow", mid = "orange", high = "red", midpoint = 0,
    name = "Effect Size")

print(forest_plot)
```
```{r pa forest}

# Create the forest plot
forest_plot <- ggplot(pa_results_df, aes(x = effect_size, y = reorder(lab, effect_size), 
                                         xmin = lower_ci, xmax = upper_ci)) +
  geom_point(size = 3, aes(color = effect_size)) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Forest Plot of Effect Sizes of Positive Affect by Lab"
  ) +
  theme_minimal() +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
  scale_color_gradient2(low = "yellow", mid = "orange", high = "red", midpoint = 0,
                        name = "Effect Size")

print(forest_plot)
```
```{r na forest}
# Create the forest plot
forest_plot <- ggplot(na_results_df, aes(x = effect_size, y = reorder(lab, effect_size), 
                                         xmin = lower_ci, xmax = upper_ci)) +
  geom_point(size = 3, aes(color = effect_size)) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Forest Plot of Effect Sizes of Negative Affect by Lab"
  ) +
  theme_minimal() +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
  scale_color_gradient2(low = "yellow", mid = "orange", high = "red", midpoint = 0,
                        name = "Effect Size")

print(forest_plot)
```
```{r life satisfaction forest}

# Create the forest plot
forest_plot <- ggplot(ls_results_df, aes(x = effect_size, y = reorder(lab, effect_size), 
                                      xmin = lower_ci, xmax = upper_ci)) +
  geom_point(size = 3, aes(color = effect_size)) +
  geom_errorbarh(height = 0.2) +
  labs(
    x = "Effect Size (Cohen's d)",
    y = "Lab",
    title = "Forest Plot of Effect Sizes of Life Satisfaction by Lab"
  ) +
  theme_minimal() +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
  scale_color_gradient2(low = "yellow", mid = "orange", high = "red", midpoint = 0,
    name = "Effect Size")

print(forest_plot)
```
```{r}
text <- data %>% filter(condition == "text")
sub <- data %>% filter(condition == "sub")
letter <- data %>% filter(condition == "letter")
hk.list <- data %>% filter(condition == "hk.list")
list <- data %>% filter(condition == "list")
god <- data %>% filter(condition == "god.letter")

test <- t.test(letter$ls_all,list$ls_all)
print(test)




```

